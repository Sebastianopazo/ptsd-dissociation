---
title: "Dissociation and PTSD - Data Analysis"
author: "Sebastián Opazo"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: lumen
---
## Documentation

(This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document).

```{r setup, echo=FALSE, results='asis'}

library("data.table") #Required library to use data tables (better than data frames apparently, see https://www.analyticsvidhya.com/blog/2016/05/data-table-data-frame-work-large-data-sets/)
library("dplyr") # Used to provide extra functionalities (https://dplyr.tidyverse.org/)
library("dataMaid")#Used for code book generation (https://CRAN.R-project.org/package=dataMaid)
library("kableExtra") #To add extra formatting options (https://haozhu233.github.io/kableExtra/)

# library("mediation") #Used to run mediation analysis


#IMPORTING DATA ----
db <- setDT(read.csv("./database/1808131054_PAP.csv"))


#DATA CLEANUP ----

#Recode provider numbers to hide identity
db <- db %>% mutate(
    t0_provider=recode(
      t0_provider,
      `Carol Perez`=0,
      `Claudia Olguín`=1,
      `Claudia Ruiz`=2,
      `Constanza González`=3,
      `Carol Perez`=4,
      `Danka Dawson`=5,
      `Ignacia Azócar`=6,
      `Ignacia Fernández`=7,
      `Ignacio García`=8,
      `Isidora Rodríguez`=9,
      `Javiera Rodríguez`=10,
      `Joaquín Zamorano`=11,
      `Macarena Segovia`=12,
      `Magdalena Fernánde`=13,
      `Montserrat Franco`=14,
      `Paula Padilla`=15,
      `Paulina Guajardo`=16,
      `Silvina Moyano`=17,
      `Simón Fercovic`=18,
      `Sofía Astorga`=19,
      `Stefanny Vicencio`=20,
      )
  )

#Generate Code Book ----

## Enforce data types (according to each variable meaning)
db <- db %>% 
    mutate_at("t0_sex", as.factor) %>%
    mutate_at("t0_recr_wave", as.factor) %>%
    mutate_at("t0_hospital", as.factor) %>%
    mutate_at("t0_provider", as.factor)


# %>% #Enforce factor column
#     mutate_at("study_site__name", as.factor) %>% #Enforce factor column
#     mutate_at("subject_id", as.integer) #Enforce integer column


attr(db$t0_sex, "label") <- "Specifies the participant's sex at time 0."
attr(db$t0_sex, "label") <- "Specifies recruitment wave ."
attr(db$t0_provider, "label") <- "Undergraduate psychology student who provided the participant's PFA-ABCDE intervention."


db[db==""] <- NA #Replace empty strings with NA.


if(file.exists("codebook.Rmd")) {
  invisible(file.remove("codebook.Rmd"))
}
if(file.exists("codebook.html")) {
  invisible(file.remove("codebook.html"))
}

makeCodebook(db, file="codebook.Rmd", reportTitle="Codebook for consolidated data", openBrowser = FALSE)

# # Create button to open the codebook file
# codebook_button <- tags$button("OPEN CODEBOOK", onclick = "window.open('all_measure_responses_codebook.html', '_blank');")
# 
# codebook_button

```

## Descriptives

You can also embed plots, for example:

```{r pressure, echo=FALSE}
```

## Mediation Analysis

```{r mediation, echo=FALSE}

# mediate(
#   mediator="pdeq",
#   boot=TRUE,
# )
# 
# jastpSem::MediationAnalysis(
#   version="0.17",
#   errorCalculationMethod = "bootstrap",
#   mediators = "pdeq",
#   outcomes = "t1_pcl",
#   pathPlot = TRUE,
#   pathPlotParameter = TRUE,
#   predictors = "tq"
# )

```